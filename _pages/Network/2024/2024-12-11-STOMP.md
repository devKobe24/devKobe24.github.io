---
title: "π[Network] STOMP(Simple/Streaming Text Messaging Protocol)λ€ λ¬΄μ—‡μΌκΉμ”?"
tags:
    - Network
date: "2024-12-11"
thumbnail: "/assets/img/thumbnail/network.jpeg"
---

# π[Network] STOMP(Simple/Streaming Text Messaging Protocol)λ€ λ¬΄μ—‡μΌκΉμ”?
- **STOMP(Simple/Streaming Text Messaging Protocol)λ” ν…μ¤νΈ κΈ°λ°μ λ©”μ‹μ§• ν”„λ΅ν† μ½**λ΅, ν΄λΌμ΄μ–ΈνΈμ™€ λ©”μ‹μ§• λΈλ΅μ»¤(Message Broker) κ°„μ ν†µμ‹ μ„ μ§€μ›ν•κΈ° μ„ν•΄ μ„¤κ³„λμ—μµλ‹λ‹¤.
    - μΌλ°μ μΌλ΅ WebSocketκ³Ό ν•¨κ» μ‚¬μ©λλ©°, Pub/Sub ν¨ν„΄μ λ©”μ‹μ§•μ„ λ” μ‰½κ² κµ¬ν„ν•  μ μκ² λ„μ™€μ¤λ‹λ‹¤.

## 1οΈβƒ£ STOMPμ μ£Όμ” νΉμ§•.
### 1οΈβƒ£ κ°„λ‹¨ν• λ©”μ‹μ§• ν”„λ΅ν† μ½.
- STOMPλ” κ°„λ‹¨ν• λ©”μ‹μ§€ ν”„λ μ„ κµ¬μ΅°λ¥Ό κ°€μ§€κ³  μμ–΄ μ΄ν•΄ν•κ³  κµ¬ν„ν•κΈ° μ‰½μµλ‹λ‹¤.
- λ©”μ‹μ§€ ν”„λ μ„μ€ λ…ν™•ν• ν—¤λ”μ™€ λ³Έλ¬Έ(Body)μΌλ΅ κµ¬μ„±λ©λ‹λ‹¤.

### 2οΈβƒ£ WebSocket μƒμ„ λ μ΄μ–΄ ν”„λ΅ν† μ½.
- STOMPλ” WebSocketμ„ κΈ°λ°μΌλ΅ λ™μ‘ν•μ§€λ§, WebSocketμ λ‹¨μν• ν†µμ‹  λ°©μ‹μ— Pub/Sub(λ°ν–‰/κµ¬λ…) κΈ°λ¥μ„ μ¶”κ°€ν•μ—¬ λ©”μ‹μ§• μ‹μ¤ν…μ„ κµ¬ν„ν•©λ‹λ‹¤.
- WebSocketμ€ λ‹¨μν μ–‘λ°©ν–¥ μ—°κ²°λ§ μ§€μ›ν•μ§€λ§, STOMPλ¥Ό ν†µν•΄ λ” λ³µμ΅ν• λ©”μ‹μ§€ μ „λ‹¬ ν¨ν„΄μ„ κµ¬ν„ν•  μ μμµλ‹λ‹¤.

### 3οΈβƒ£ μ„λ²„μ™€ ν΄λΌμ΄μ–ΈνΈ κ°„μ λ©”μ‹μ§•.
- STOMPλ” **μ„λ²„-ν΄λΌμ΄μ–ΈνΈ** λλ” **ν΄λΌμ΄μ–ΈνΈ-ν΄λΌμ΄μ–ΈνΈ** κ°„μ λ©”μ‹μ§€λ¥Ό μ „μ†΅ν•  μ μλ„λ΅ μ„¤κ³„λμ—μµλ‹λ‹¤.
- μ£Όλ΅ λ©”μ‹μ§€ λΈλ΅μ»¤(μ: ActiveMQ, RabbitMQ)μ™€ ν•¨κ» μ‚¬μ©λ©λ‹λ‹¤.

### 4οΈβƒ£ Pub/Sub ν¨ν„΄ μ§€μ›.
- ν΄λΌμ΄μ–ΈνΈλ” νΉμ • μ£Όμ (Topic) λλ” ν(Queue)λ¥Ό κµ¬λ…(Subscribe)ν•μ—¬, ν•΄λ‹Ή μ£Όμ μ— λ°ν–‰λ λ©”μ‹μ§€λ¥Ό λ°›μ„ μ μμµλ‹λ‹¤.

## 2οΈβƒ£ STOMP ν”„λ μ„ κµ¬μ΅°.
- STOMP λ©”μ‹μ§€ ν”„λ μ„μ€ λ‹¤μκ³Ό κ°™μ€ κµ¬μ΅°λ΅ λμ–΄ μμµλ‹λ‹¤.

### μ”μ† κµ¬μ„±.
#### 1οΈβƒ£ λ…λ Ή(command)
- ν”„λ μ„μ λ©μ μ„ μ •μν•©λ‹λ‹¤.(μ: CONNECT, SEND, SUBSCRIBE, UNSUBSCRIBE)

#### 2οΈβƒ£ ν—¤λ”(headers)
- ν”„λ μ„κ³Ό κ΄€λ ¨λ μ¶”κ°€ μ •λ³΄λ¥Ό ν¬ν•¨ν•©λ‹λ‹¤.(μ: λ©μ μ§€, μ½ν…μΈ  νƒ€μ… λ“±)

#### 3οΈβƒ£ λ³Έλ¬Έ(body)
- λ©”μ‹μ§€ λ‚΄μ©(μ„ νƒ μ‚¬ν•­)

### μμ 
- μ•„λλ” λ©”μ‹μ§€ μ „μ†΅(SEND) ν”„λ μ„ μμ μ…λ‹λ‹¤.
```hash
SEND
destination:/queue/test
content-type:text/plain

Hello, STOMP!
```
- **λ…λ Ή :** SEND
- **ν—¤λ” :** destination:/queue/test, content-type:text/plain
- **λ³Έλ¬Έ :** Hello, STOMP!

## 3οΈβƒ£ Springμ—μ„ STOMP μ‚¬μ© μμ .
- Spring Bootλ” **STOMP**μ™€ **WebSocket**μ„ κ²°ν•©ν•μ—¬ λ©”μ‹μ§•μ„ κµ¬ν„ν•  μ μλ„λ΅ κΈ°λ¶„ μ§€μ›μ„ μ κ³µν•©λ‹λ‹¤.

### 1οΈβƒ£ STOMP μμ΅΄μ„± μ¶”κ°€.
- build.gradle λλ” pom.xmlμ— λ‹¤μ μμ΅΄μ„±μ„ μ¶”κ°€ν•©λ‹λ‹¤.

```groovy
implementation 'org.springframework.boot:spring-boot-starter-websocket'
```

### 2οΈβƒ£ WebSocket μ„¤μ •.
- STOMP μ—”λ“ν¬μΈνΈμ™€ λ©”μ‹μ§€ λΈλ΅μ»¤λ¥Ό μ„¤μ •ν•λ” `@Configuration` ν΄λμ¤λ¥Ό μ‘μ„±ν•©λ‹λ‹¤.
```java
import org.springframework.context.annotation.Configuration;
import org.springframework.messaging.simp.config.MessageBrokerRegistry;
import org.springframework.web.socket.config.annotation.EnableWebSocketMessageBroker;
import org.springframework.web.socket.config.annotation.WebSocketMessageBrokerConfigurer;

@Configuration
@EnableWebSocketMessageBroker
public class WebSocketConfig implements WebSocketMessageBrokerConfigurer {

    @Override
    public void configureMessageBroker(MessageBrokerRegistry config) {
        config.enableSimpleBroker("/topic"); // ν΄λΌμ΄μ–ΈνΈ κµ¬λ… μ£Όμ†
        config.setApplicationDestinationPrefixes("/app"); // ν΄λΌμ΄μ–ΈνΈ λ°ν–‰ μ£Όμ†
    }

    @Override
    public void registerStompEndpoints(org.springframework.web.socket.config.annotation.StompEndpointRegistry registry) {
        registry.addEndpoint("/ws") // WebSocket μ—”λ“ν¬μΈνΈ
                .setAllowedOrigins("*") // CORS ν—μ©
                .withSockJS(); // SockJS μ§€μ›
    }
}
```

### 3οΈβƒ£ μ»¨νΈλ΅¤λ¬
- STOMP λ©”μ‹μ§€λ¥Ό μ²λ¦¬ν•  μ»¨νΈλ΅¤λ¬λ¥Ό μ‘μ„±ν•©λ‹λ‹¤.
```java
import org.springframework.messaging.handler.annotation.MessageMapping;
import org.springframework.messaging.handler.annotation.SendTo;
import org.springframework.stereotype.Controller;

@Controller
public class ChatController {

    @MessageMapping("/sendMessage") // ν΄λΌμ΄μ–ΈνΈκ°€ λ©”μ‹μ§€ λ°ν–‰ν•  κ²½λ΅
    @SendTo("/topic/messages") // κµ¬λ…λ ν΄λΌμ΄μ–ΈνΈμ—κ² λ³΄λ‚Ό κ²½λ΅
    public String sendMessage(String message) {
        return "μ„λ²„ μ‘λ‹µ: " + message;
    }
}
```

### 4οΈβƒ£ ν΄λΌλ¦¬μ–ΈνΈ JavaScript
- JavaScriptλ¥Ό μ‚¬μ©ν•μ—¬ STOMP λ©”μ‹μ§€λ¥Ό μ „μ†΅ν•κ³  μμ‹ ν•©λ‹λ‹¤.
```javascript
const socket = new SockJS('/ws'); // μ„λ²„ WebSocket μ—”λ“ν¬μΈνΈ
const stompClient = Stomp.over(socket);

stompClient.connect({}, () => {
    console.log('WebSocket μ—°κ²°λ¨');

    // λ©”μ‹μ§€ κµ¬λ…
    stompClient.subscribe('/topic/messages', (message) => {
        console.log('μμ‹ ν• λ©”μ‹μ§€:', message.body);
    });

    // λ©”μ‹μ§€ λ°ν–‰
    stompClient.send('/app/sendMessage', {}, 'Hello from client!');
});
```

## 4οΈβƒ£ κ²°λ΅ .
- STOMPλ” WebSocketμ„ λ³΄μ™„ν•μ—¬ ν¨μ¨μ μΌλ΅ λ©”μ‹μ§€λ¥Ό λ°ν–‰ν•κ³  κµ¬λ…ν•λ” λ° λ„μ›€μ„ μ£Όλ” κ³ μμ¤€ ν”„λ΅ν† μ½μ…λ‹λ‹¤.
- Spring Bootμ—μ„ κΈ°λ³Έμ μΌλ΅ μ§€μ›ν•λ―€λ΅, μ‰½κ² μ‹¤μ‹κ°„ κΈ°λ¥μ„ κµ¬ν„ν•  μ μμµλ‹λ‹¤.
