---
title: "ğŸ”[Troubleshooting] ğŸš€ Not-Null ì œì•½ ì¡°ê±´ ìœ„ë°˜"
tags:
    - Troubleshooting
    - Backend Development
    - Spring Boot
date: "2025-10-03"
thumbnail: "/assets/img/thumbnail/troubleshooting.jpg"
---

# ğŸš€ Not-Null ì œì•½ ì¡°ê±´ ìœ„ë°˜!

## ğŸš¨ ì—ëŸ¬ ë©”ì‹œì§€

```
org.hibernate.PropertyValueException: 
not-null property references a null or transient value: 
com.kobe.schoolmanagement.domain.entity.Student.major
```

### ìµœì¢… ì˜ˆì™¸
```
DataIntegrityViolationException
```

---

## ğŸ” í•µì‹¬ ì›ì¸

**`Student` ì—”í‹°í‹°ì˜ `major` í•„ë“œê°€ `null`ì¸ ìƒíƒœë¡œ ì €ì¥ì„ ì‹œë„í–ˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.**

### ì œì•½ ì¡°ê±´ í™•ì¸

```java
@Entity
public class Student {
    // ...
    
    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(nullable = false, name = "major_id")  // âŒ null í—ˆìš© ì•ˆ í•¨
    private Major major;
}
```

`nullable = false` ì„¤ì •ìœ¼ë¡œ ì¸í•´ `major` í•„ë“œëŠ” **ë°˜ë“œì‹œ ê°’ì´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.**

---

## ğŸ“Š ë¬¸ì œ ë°œìƒ íë¦„

```
í´ë¼ì´ì–¸íŠ¸ ìš”ì²­
    â†“
{"name": "ê°•ë¯¼ì„±", "admissionYear": 2010, "majorName": "Computer"}
    â†“
StudentRequestDto ìˆ˜ì‹ 
    â†“
StudentService.createStudent() í˜¸ì¶œ
    â†“
requestDto.toEntity(studentId) ì‹¤í–‰
    â†“
Student ì—”í‹°í‹° ìƒì„±
    â”œâ”€â”€ name: "ê°•ë¯¼ì„±" âœ…
    â”œâ”€â”€ admissionYear: 2010 âœ…
    â””â”€â”€ major: null âŒ  (Major ì—”í‹°í‹°ë¥¼ ì¡°íšŒí•˜ì§€ ì•ŠìŒ!)
    â†“
studentRepository.save(student)
    â†“
Hibernateê°€ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥ ì‹œë„
    â†“
NOT NULL ì œì•½ ì¡°ê±´ ìœ„ë°˜ ê°ì§€
    â†“
PropertyValueException ë°œìƒ
    â†“
DataIntegrityViolationException
```

---

## ğŸ’¡ ë¬¸ì œ ìƒí™© ë¶„ì„

### ëˆ„ë½ëœ ë¡œì§

| ë‹¨ê³„ | í˜„ì¬ ìƒí™© | í•„ìš”í•œ ì‘ì—… |
|------|----------|-------------|
| 1 | `majorName` ë¬¸ìì—´ ìˆ˜ì‹  | âœ… ì™„ë£Œ |
| 2 | `majorName`ìœ¼ë¡œ `Major` ì—”í‹°í‹° ì¡°íšŒ | âŒ **ëˆ„ë½ë¨** |
| 3 | ì¡°íšŒí•œ `Major` ê°ì²´ë¥¼ `Student`ì— ì„¤ì • | âŒ **ëˆ„ë½ë¨** |
| 4 | `Student` ì €ì¥ | âœ… ì‹œë„í–ˆìœ¼ë‚˜ ì‹¤íŒ¨ |

### ê²°ê³¼
```
majorName: "Computer" (String)
    â†“
âŒ Major ì—”í‹°í‹° ì¡°íšŒ ë¡œì§ ì—†ìŒ
    â†“
major í•„ë“œ: null
    â†“
ì €ì¥ ì‹¤íŒ¨!
```

---

## âœ… í•´ê²° ë°©ì•ˆ

3ë‹¨ê³„ë¡œ ë¬¸ì œë¥¼ í•´ê²°í•©ë‹ˆë‹¤.

---

### Step 1: MajorRepository ë©”ì„œë“œ ì¶”ê°€

`Major` ì—”í‹°í‹°ë¥¼ ì „ê³µ ì´ë¦„ìœ¼ë¡œ ì¡°íšŒí•  ìˆ˜ ìˆëŠ” ë©”ì„œë“œë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.

```java
package com.kobe.schoolmanagement.repository;

import com.kobe.schoolmanagement.domain.entity.Major;
import org.springframework.data.jpa.repository.JpaRepository;
import java.util.Optional;

public interface MajorRepository extends JpaRepository<Major, Long> {
    
    Optional<Major> findByMajorNumber(String majorNumber);
    
    // âœ… ì „ê³µ ì´ë¦„ìœ¼ë¡œ ì¡°íšŒí•˜ëŠ” ë©”ì„œë“œ ì¶”ê°€
    Optional<Major> findByName(String name);
}
```

#### ğŸ’¡ Spring Data JPA ì¿¼ë¦¬ ë©”ì„œë“œ
```java
findByName("Computer")
// â†“ ìë™ìœ¼ë¡œ ë‹¤ìŒ ì¿¼ë¦¬ ìƒì„±
// SELECT * FROM major WHERE name = 'Computer'
```

---

### Step 2: StudentService ë¡œì§ ìˆ˜ì •

`Major` ì—”í‹°í‹°ë¥¼ ì¡°íšŒí•˜ê³  `Student`ì— ì„¤ì •í•˜ëŠ” ë¡œì§ì„ ì¶”ê°€í•©ë‹ˆë‹¤.

#### Before
```java
@Transactional
public StudentResponseDto createStudent(StudentRequestDto requestDto) {
    int admissionYear = requestDto.getAdmissionYear();
    String majorName = requestDto.getMajorName();
    
    // âŒ Major ì—”í‹°í‹° ì¡°íšŒ ì—†ìŒ
    
    long sequence = studentRepository.countByAdmissionYearAndMajorName(
        admissionYear, majorName) + 1;
    
    String studentId = createStudentNumber.generate(
        admissionYear, majorName, sequence);
    
    // âŒ majorê°€ nullì¸ ìƒíƒœë¡œ ì—”í‹°í‹° ìƒì„±
    Student student = requestDto.toEntity(studentId);
    Student savedStudent = studentRepository.save(student);
    
    return StudentResponseDto.fromEntity(savedStudent);
}
```

#### After
```java
package com.kobe.schoolmanagement.service;

import com.kobe.schoolmanagement.common.CreateStudentNumber;
import com.kobe.schoolmanagement.domain.entity.Major;
import com.kobe.schoolmanagement.domain.entity.Student;
import com.kobe.schoolmanagement.dto.request.StudentRequestDto;
import com.kobe.schoolmanagement.dto.response.StudentResponseDto;
import com.kobe.schoolmanagement.repository.MajorRepository;
import com.kobe.schoolmanagement.repository.StudentRepository;
import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

@Service
@RequiredArgsConstructor
public class StudentService {
    
    private final StudentRepository studentRepository;
    private final MajorRepository majorRepository;  // âœ… ì˜ì¡´ì„± ì£¼ì…
    private final CreateStudentNumber createStudentNumber;

    @Transactional
    public StudentResponseDto createStudent(StudentRequestDto requestDto) {
        // 1. DTOë¡œë¶€í„° í•„ìš”í•œ ì •ë³´ ì¶”ì¶œ
        int admissionYear = requestDto.getAdmissionYear();
        String majorName = requestDto.getMajorName();

        // âœ… 2. Major ì—”í‹°í‹° ì¡°íšŒ (í•µì‹¬ ìˆ˜ì •)
        Major major = majorRepository.findByName(majorName)
                .orElseThrow(() -> new IllegalArgumentException(
                    "ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì „ê³µì…ë‹ˆë‹¤: " + majorName));

        // 3. í•™ìƒ ìˆ˜ ì¹´ìš´íŠ¸
        long sequence = studentRepository.countByAdmissionYearAndMajorName(
            admissionYear, majorName) + 1;

        // 4. í•™ë²ˆ ìƒì„±
        String studentId = createStudentNumber.generate(
            admissionYear, majorName, sequence);

        // 5. í•™ë²ˆ ì¤‘ë³µ ê²€ì‚¬
        studentRepository.findByStudentId(studentId).ifPresent(s -> {
            throw new IllegalStateException("í•™ë²ˆ ìƒì„± ì¶©ëŒ ë°œìƒ. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”");
        });

        // âœ… 6. major ê°ì²´ë¥¼ í•¨ê»˜ ì „ë‹¬í•˜ì—¬ ì—”í‹°í‹° ìƒì„±
        Student student = requestDto.toEntity(studentId, major);
        Student savedStudent = studentRepository.save(student);

        return StudentResponseDto.fromEntity(savedStudent);
    }

    @Transactional(readOnly = true)
    public StudentResponseDto getStudent(String studentId) {
        Student student = studentRepository.findByStudentId(studentId)
            .orElseThrow(() -> new IllegalArgumentException(
                "ì¡´ì¬í•˜ì§€ ì•ŠëŠ” í•™ìƒì…ë‹ˆë‹¤."));

        return StudentResponseDto.fromEntity(student);
    }
}
```

#### ğŸ’¡ ì£¼ìš” ë³€ê²½ì‚¬í•­
```java
// 1. MajorRepository ì£¼ì… ì¶”ê°€
private final MajorRepository majorRepository;

// 2. Major ì—”í‹°í‹° ì¡°íšŒ
Major major = majorRepository.findByName(majorName)
    .orElseThrow(() -> new IllegalArgumentException("ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì „ê³µì…ë‹ˆë‹¤"));

// 3. toEntity()ì— major ì „ë‹¬
Student student = requestDto.toEntity(studentId, major);
```

---

### Step 3: StudentRequestDto.toEntity() ë©”ì„œë“œ ìˆ˜ì •

`toEntity` ë©”ì„œë“œê°€ `Major` ê°ì²´ë¥¼ ë°›ì•„ì„œ ì„¤ì •í•˜ë„ë¡ ìˆ˜ì •í•©ë‹ˆë‹¤.

#### Before
```java
public class StudentRequestDto {
    private String name;
    private int admissionYear;
    private String majorName;
    
    public Student toEntity(String studentId) {
        return Student.builder()
                .name(this.name)
                .studentId(studentId)
                .admissionYear(this.admissionYear)
                // âŒ major í•„ë“œ ì„¤ì • ì—†ìŒ (nullë¡œ ë‚¨ìŒ)
                .build();
    }
}
```

#### After
```java
public class StudentRequestDto {
    private String name;
    private int admissionYear;
    private String majorName;
    
    // âœ… Major ê°ì²´ë¥¼ íŒŒë¼ë¯¸í„°ë¡œ ë°›ë„ë¡ ìˆ˜ì •
    public Student toEntity(String studentId, Major major) {
        return Student.builder()
                .name(this.name)
                .studentId(studentId)
                .admissionYear(this.admissionYear)
                .major(major)  // âœ… Major ê°ì²´ ì„¤ì •
                .build();
    }
}
```

---

## ğŸ”„ ìˆ˜ì • í›„ ë°ì´í„° íë¦„

```
í´ë¼ì´ì–¸íŠ¸ ìš”ì²­
    â†“
{"name": "ê°•ë¯¼ì„±", "admissionYear": 2010, "majorName": "Computer"}
    â†“
StudentService.createStudent()
    â†“
majorRepository.findByName("Computer")  âœ… ì¶”ê°€ë¨
    â†“
Major ì—”í‹°í‹° ì¡°íšŒ ì„±ê³µ
    â””â”€â”€ id: 1
    â””â”€â”€ majorNumber: "31513162120518"
    â””â”€â”€ name: "Computer"
    â†“
requestDto.toEntity(studentId, major)  âœ… major ì „ë‹¬
    â†“
Student ì—”í‹°í‹° ìƒì„±
    â”œâ”€â”€ name: "ê°•ë¯¼ì„±" âœ…
    â”œâ”€â”€ admissionYear: 2010 âœ…
    â””â”€â”€ major: Major ê°ì²´ âœ… (null ì•„ë‹˜!)
    â†“
studentRepository.save(student)
    â†“
ì €ì¥ ì„±ê³µ! âœ…
```

---

## ğŸ“‹ ì „ì²´ ìˆ˜ì • ìš”ì•½

| íŒŒì¼ | ìˆ˜ì • ë‚´ìš© | ëª©ì  |
|------|----------|------|
| **MajorRepository** | `findByName()` ë©”ì„œë“œ ì¶”ê°€ | ì „ê³µ ì´ë¦„ìœ¼ë¡œ ì¡°íšŒ |
| **StudentService** | `majorRepository` ì£¼ì…<br>`Major` ì¡°íšŒ ë¡œì§ ì¶”ê°€<br>`toEntity()`ì— `major` ì „ë‹¬ | Major ì—”í‹°í‹° ì¡°íšŒ ë° ì„¤ì • |
| **StudentRequestDto** | `toEntity()` ì‹œê·¸ë‹ˆì²˜ ë³€ê²½<br>`major` í•„ë“œ ì„¤ì • ì¶”ê°€ | Major ê°ì²´ë¥¼ ë°›ì•„ì„œ ì„¤ì • |

---

## âœ… í…ŒìŠ¤íŠ¸

### Postman ìš”ì²­
```json
POST http://localhost:8080/api/v1/students

{
    "name": "ê°•ë¯¼ì„±",
    "admissionYear": 2010,
    "majorName": "Computer"
}
```

### ì˜ˆìƒ ì‘ë‹µ
```json
{
    "name": "ê°•ë¯¼ì„±",
    "admissionYear": 2010,
    "major_info": {
        "id": 1,
        "majorNumber": "31513162120518",
        "name": "Computer"
    }
}
```

### ë°ì´í„°ë² ì´ìŠ¤ í™•ì¸
```sql
-- Student í…Œì´ë¸”
SELECT * FROM student;
```
| id | name | student_id | admission_year | major_id |
|----|------|------------|----------------|----------|
| 1 | ê°•ë¯¼ì„± | 1003001 | 2010 | 1 âœ… |

---

## âš ï¸ ì£¼ì˜ì‚¬í•­

### 1. ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì „ê³µëª… ì²˜ë¦¬

```java
Major major = majorRepository.findByName(majorName)
    .orElseThrow(() -> new IllegalArgumentException(
        "ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì „ê³µì…ë‹ˆë‹¤: " + majorName));
```

- ì¡´ì¬í•˜ì§€ ì•ŠëŠ” `majorName`ì„ ë°›ìœ¼ë©´ ì˜ˆì™¸ ë°œìƒ
- ì‚¬ì „ì— `Major` ë°ì´í„°ê°€ DBì— ìˆì–´ì•¼ í•¨

### 2. Major ë°ì´í„° ì‚¬ì „ ë“±ë¡

```java
// Major ì—”í‹°í‹°ë¥¼ ë¯¸ë¦¬ ì €ì¥í•´ì•¼ í•¨
Major computerMajor = Major.builder()
    .majorNumber("31513162120518")
    .name("Computer")
    .build();
majorRepository.save(computerMajor);
```

---

## ğŸ“Œ Best Practices

### 1. DTOì—ì„œ ì—”í‹°í‹° ì°¸ì¡° ì„¤ì •

```java
// âŒ ë‚˜ìœ ì˜ˆ: DTOì—ì„œ ì§ì ‘ ì¡°íšŒ
public Student toEntity(String studentId) {
    Major major = majorRepository.findByName(this.majorName).orElseThrow();
    // DTOê°€ Repositoryì— ì˜ì¡´í•˜ê²Œ ë¨!
}

// âœ… ì¢‹ì€ ì˜ˆ: íŒŒë¼ë¯¸í„°ë¡œ ë°›ê¸°
public Student toEntity(String studentId, Major major) {
    // ì˜ì¡´ì„±ì´ ëª…í™•í•˜ê³  í…ŒìŠ¤íŠ¸í•˜ê¸° ì‰¬ì›€
}
```

### 2. ì˜ˆì™¸ ë©”ì‹œì§€ì— ì»¨í…ìŠ¤íŠ¸ í¬í•¨

```java
// âŒ ë‚˜ìœ ì˜ˆ
throw new IllegalArgumentException("ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì „ê³µì…ë‹ˆë‹¤.");

// âœ… ì¢‹ì€ ì˜ˆ
throw new IllegalArgumentException("ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì „ê³µì…ë‹ˆë‹¤: " + majorName);
```

### 3. ì—”í‹°í‹° ì œì•½ ì¡°ê±´ í™•ì¸

```java
@JoinColumn(nullable = false, name = "major_id")
// â””â”€ nullable = false ì„¤ì • í™•ì¸
//    í•„ìˆ˜ í•„ë“œëŠ” ë°˜ë“œì‹œ ê°’ì„ ì„¤ì •í•´ì•¼ í•¨
```

---

## ğŸ”§ íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### Q1. "ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì „ê³µì…ë‹ˆë‹¤" ì˜ˆì™¸ê°€ ê³„ì† ë°œìƒí•´ìš”

**ì›ì¸**: Major ë°ì´í„°ê°€ DBì— ì—†ìŒ

**í•´ê²°**:
```sql
-- Major ë°ì´í„° í™•ì¸
SELECT * FROM major WHERE name = 'Computer';

-- ë°ì´í„°ê°€ ì—†ë‹¤ë©´ ì‚½ì…
INSERT INTO major (major_number, name) 
VALUES ('31513162120518', 'Computer');
```

### Q2. major_idê°€ nullë¡œ ì €ì¥ë˜ì–´ìš”

**ì›ì¸**: `Student.builder()`ì—ì„œ `major()` ë©”ì„œë“œ í˜¸ì¶œ ëˆ„ë½

**í•´ê²°**:
```java
Student.builder()
    .name(this.name)
    .studentId(studentId)
    .admissionYear(this.admissionYear)
    .major(major)  // âœ… ì´ ì¤„ ì¶”ê°€ í™•ì¸
    .build();
```

### Q3. LazyInitializationExceptionì´ ë°œìƒí•´ìš”

**ì›ì¸**: `FetchType.LAZY`ë¡œ ì„¤ì •ëœ majorë¥¼ íŠ¸ëœì­ì…˜ ë°–ì—ì„œ ì ‘ê·¼

**í•´ê²°**:
```java
@Transactional(readOnly = true)  // âœ… íŠ¸ëœì­ì…˜ ë²”ìœ„ í™•ì¸
public StudentResponseDto getStudent(String studentId) {
    Student student = studentRepository.findByStudentId(studentId)
        .orElseThrow();
    return StudentResponseDto.fromEntity(student);  // íŠ¸ëœì­ì…˜ ë‚´ì—ì„œ ë³€í™˜
}
```
