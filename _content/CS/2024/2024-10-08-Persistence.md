---
title: "💾 [CS] 영속성(Persistence)란 무엇일까?"
tags:
    - CS
date: "2024-10-08"
thumbnail: "/assets/img/thumbnail/cs.jpeg"
---

# "💾 [CS] 영속성(Persistence)란 무엇일까?"

- **영속성(Persistence)** 이란 **데이터나 객체의 상태를 지속적으로 저장하여 프로그램이 종료되거나 시스템이 재부팅되더라도 그 상태가 유지되는 것을 의미합니다.**
- 간단히 말하면, 영속성은 데이터를 영구적으로 저장하는 능력을 가리킵니다.
- 소프트웨어 시스템에서는 주로 데이터베이스, 파일 시스템, 영속 저장소와 같은 외부 저장소에 데이터를 저장하는 것을 영속성이라고 합니다.

## 1️⃣ 영속성의 예.
- **데이터베이스에 저장된 데이터**
    - 데이터베이스에 저장된 데이터는 시스템이 종료되거나 전원이 꺼져도 영구적으로 저장됩니다.
    - 프로그램이 다시 실행될 때 이 데이터를 불러와서 사용할 수 있습니다.
- **파일 시스템에 저장된 데이터**
    - 파일 시스템에 저장된 파일도 시스템 재부팅 후에도 유지되며, 나중에 다시 사용할 수 있습니다.

## 2️⃣ 영속성의 중요성.
- 소프트웨어 시스템에서는 대부분의 데이터가 메모리(휘발성)에만 존재하면 프로그램이 종료되거나 장애가 발생할 때 데이터를 잃게 됩니다.
- **영속성**을 사용하면 프로그램이 종료되더라도 중요한 데이터는 **데이터베이스나 파일 시스템에 저장되므로** 시스템이 다시 시작되었을 때 데이터를 복구하거나 이어서 사용할 수 있습니다.

---

## 3️⃣ Java 및 Spring에서의 영속성.
- Java 환경, 특히 **JPA(Java Persistence API)** 를 사용하는 애플리케이션에서 **영속성**은 주로 **데이터베이스와 자바 객체 간의 상태 유지를 의미합니다.**
- JPA는 자바 객체를 데이터베이스에 영속적으로 저장하고, 필요할 때 데이터를 조회하여 다시 객체로 변환하는 과정을 자동으로 처리합니다.

### JAP에서의 주요 개념.

#### 1. 영속성 컨텍스트(Persistence Context)
- 영속성 컨텍스트는 JPA에서 자바 객체(Entity)를 관리하는 일종의 캐시 메모리입니다.
- 엔티티가 영속성 컨텍스트에 포함되면, 해당 엔티티는 데이터베이스에 **영속**됩니다.
- 영속성 컨텍스트는 엔티티의 상태 변화를 감지하고, 그 변화가 트랜잭션이 끝날 때 데이터베이스에 반영되도록 관리합니다.

#### 2. 엔티티(Entity)
- JPA에서 엔티티는 데이터베이스의 테이블과 매핑되는 **자바 객체**입니다.
- 엔티티는 데이터를 영속적으로 유지하기 위한 수단으로, JPA는 이를 데이터베이스에 저장하고 다시 불러옵니다.

#### 3. EntityManager
- `EntityManager`는 JPA의 핵심 인테페이스로, 엔티티의 **CRUD(생성, 조회, 수정, 삭제)** 작업을 담당합니다.
- `EntityManager`는 영속성 컨텍스트를 관리하며, 데이터베이스와의 상호작용을 처리합니다.
- `persist()` 메서드를 통해 엔티티를 영속성 컨텍스트에 저장하고, 이를 데이터베이스에 반영할 수 있습니다.

#### 4. 영속 상태(Persistent State)
- JPA에서 엔티티 객체는 다음 세 가지 상태를 가집니다.
    - **비영속(Transient) :** 데이터베이스와 전혀 연결되지 않은 상태입니다.
    - **영속(Persistent) :** 엔티티가 영속성 컨텍스트에 포함되어 관리되고 있는 상태로, 데이터베이스에 기록되거나 기록될 준비가 되어 있는 상태입니다.
    - **준영속(Detached) :** 영속성 컨텍스트에 의해 관리되지 않지만 데이터베이스에는 여전히 존재하는 상태입니다.

#### 영속 상태 전이 예시
```java
@Entity
public class User {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    private String name;
    
    // Getters, Setters, Constructors
}
```

```java
// 영속성 컨텍스트와 EntityManager를 사용한 영속성 예시
EntityManager entityManager = entityManagerFactory.createEntityManager();
entityManager.getTransaction().begin();

// 1. 비영속 상태: User 객체는 아직 데이터베이스와 연결되지 않음
User user = new User();
user.setName("Kobe");

// 2. 영속 상태: persist()로 영속성 컨텍스트에 저장됨
entityManager.persist(user);

// 3. 트랜잭션이 완료되면, 데이터베이스에 저장됨
entityManager.getTransaction().commit();
entityManager.close();
```

#### 설명.

- **비영속 상태 :** `new User()`로 생성된 객체는 메모리에서만 존재하고, 아직 데이터베이스와 연결되지 않았습니다.
- **영속 상태 :** `entityManager.persist(user)`를 호출하면 객체는 영속성 컨텍스트에 저장되고, 데이터베이스에 반영될 준비가 됩니다.
- 트랜잭션이 커밋되면, 영속성 컨텍스트에 있는 객체의 상태가 데이터베이스에 영구적으로 저장됩니다.

---

## 4️⃣ 정리.
- **영속성**은 데이터를 **영구적으로 저장하는 기능입니다.**
    - 주로 데이터베이스나 파일 시스템에 데이터를 저장하여 프로그램이 종료되더라도 데이터가 유지될 수 있게 합니다.
- **JPA에서 영속성**은 객체(Entity)의 **상태를** 영속성 컨텍스트에서 관리하고, 이 상태가 **데이터베이스와 연동되어** 지속될 수 있게 하는 것을 의미합니다.
- **영속성 컨텍스트는** JPA에서 엔티티 객체의 상태를 관리하고, 데이터베이스와의 동기화를 처리하는 중요한 메커니즘입니다.
