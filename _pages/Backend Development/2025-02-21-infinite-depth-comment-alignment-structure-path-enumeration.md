---
title: "📚[Backend Development] 무한 Depth 댓글 정렬 구조의 'Path Enumeration(경로 열거) 방식'이란 무엇일까요?"
tags:
    - Backend Ddevelopment
date: "2025-02-21"
thumbnail: "/assets/img/thumbnail/BackendDevelopment.jpg"
---

# "📚[Backend Development] 무한 Depth 댓글 정렬 구조의 'Path Enumeration(경로 열거) 방식'이란 무엇일까요?"
## ✅ 무한 Depth 댓글 정렬 구조의 "Path Enumeration(경로 열거) 방식" 설명.
- Path Enumeration(경로 열거) 방식은 **트리 구조의 계층을 문자열 형태로 저장하여 정렬 및 검색을 효율적으로 수행**하는 방식입니다.
- 이 방식은 **트리의 부모-자식 관계를 유지하면서 빠르게 정렬 및 조회할 수 있도록 도와줍니다.**

## 🏗️1️⃣ Path Enumeration(경로 열거) 방식이란?
- Path Enumeration(경로 열거) 방식에서는 **각 댓글의 부모-자식 관계를 문자열 경로(path)로 저장**합니다.
- 즉, **각 댓글이 트리 구조에서 어떤 위치에 있는지 경로를 미리 기록하여 정렬 및 검색을 최적화**합니다.

## 🏗️2️⃣ 테이블 구조.
- Path Enumeration(경로 열거) 방식을 사용하면 다음과 같은 **추가적인 path 컬럼이 필요**합니다.

| 필드명            | 설명                                  |
| ----------------- | ------------------------------------- |
| comment_id        | 댓글의 고유 ID (PK)                   |
| parent_comment_id | 부모 댓글의 ID (최상위 댓글이면 NULL) |
| article_id        | 해당 댓글이 속한 게시글 ID            |
| content           | 댓글 내용                             |
|created_at|댓글 작성 시간|
|path|댓글의 계층 구조를 나타내는 문자열 (예: "00001.00002.00005"|

- 📌 **path 필드는 각 댓글이 트리 구조에서 어디에 속하는지 나타냄**
- 📌 **이 값을 활용하면 부모-자식 관계를 정렬 및 조회하는 것이 쉬워짐**

## 🏗️3️⃣ Path 값 저장 방식.
- path 값은 댓글이 **트리에서 어떤 위치에 있는지**를 나타냅니다.
- 각 comment_id를 5자리 문자열(00001, 00002 등)로 변환하여 부모-자식 관계를 저장합니다.

### 📌 Path 값 예시

|comment_id|parent_comment_id|path|
| -------- | -------- | -------- |
|1|NULL|00001|
|2|1|00001.00002|
|3|NULL|00003|
|4|2|00001.00002.00004|
|5|4|00001.00002.00004.00005|
|6|NULL|00006|

- 📌 **각 댓글은 부모 path를 상속받고, 자신의 ID를 추가하여 path를 생성**
- 📌 **부모 댓글이 삭제되더라도 path를 통해 계층 구조를 쉽게 유지 가능**

## 🏗️4️⃣ Path Enumeration(경로 열거)을 활용한 정렬.
- Path Enumeration(경로 열거)을 활용하면 **경로 순서대로 정렬하면 댓글을 계층 구조 그대로 유지할 수 있습니다.**

```sql
SELECT * FROM comment
WHERE article_id = ?
ORDER BY path ASC;
```

- 📌 **ORDER BY path ASC를 적용하면 트리 구조를 유지하면서 정렬됨**
- 📌 **일반적인 ORDER BY parent_comment_id, comment_id보다 트리 구조 정렬이 정확함**

## 🏗️5️⃣ Path Enumeration(경로 열거) 방식으로 조회
### 📌 예제 데이터

|comment_id|parent_comment_id|path|
| -------- | -------- | -------- |
|1|NULL|00001|
|2|1|00001.00002|
|3|NULL|00003|
|4|2|00001.00002.00004|
|5|4|000001.00002.00004.00005|
|6|NULL|00006|

### 📌 정렬된 결과.
```sql
SELECT * FROM comment
WHERE article_id = ?
ORDER BY path ASC;
```

#### ✅ 출력 결과
```
1. 댓글1
    ├── 댓글2
        ├── 댓글4
            ├── 댓글5
2. 댓글3
3. 댓글6
```

- 📌 **계층 구조가 정확하게 유지되면서 정렬됨.**

## 🏗️6️⃣ 특정 댓글의 하위 댓글 조회.
- Path Enumeration(경로 열거) 방식에서는 **특정 댓글의 모든 하위 댓글을 손쉽게 조회**할 수 있습니다.

```sql
SELECT * FROM comment
WHERE path LIKE '00001.00002%'
ORDER BY path ASC;
```

- 📌 **결과:** 00001.00002로 시작하는 모든 하위 댓글을 조회 (댓글2, 댓글4, 댓글5 포함)

## 🏗️7️⃣ Path Enumeration 방식의 장점과 단점.
### ✅ 장점.

|장점|설명|
| -------- | -------- |
|트리 구조 유지가 쉬움|ORDER BY path ASC만으로 계층 구조 정렬 가능|
|하위 댓글 조회가 빠름|LIKE '경로%'로 손쉽게 하위 댓글 조회 가능|
|부모 댓글 삭제 시 계층 구조 유지 가능|path를 통해 상위 댓글을 식별 가능|

### ❌ 단점.

|단점|설명|
| -------- | -------- |
|댓글 이동 시 path 업데이트 필요|댓글을 다른 부모로 이동하면 path를 변경해야 함|
|path 길이 증가 가능성|댓글이 깊어질수록 path 길이가 길어질 수 있음|
|INSERT 성능 저하 가능성|새로운 댓글 추가 시 path를 계산해야 함|

## 🏗️8️⃣ Path Enumeration(경로 열거) 방식에서 댓글 저장 규칙.
<img src = "https://github.com/devKobe24/images2/blob/main/this_is_backend_img/infinite-depth-example.png?raw=true">

- 위 그림과 같이, 각 depth(계층)별로 5개의 문자열로 경로 정보를 저장합니다.
    - 1 depth는 5자리 문자열, 2 depth는 10자리, 3 depth는 15자리 N depth는 (N * 5)자리로 표현됩니다.
- 각 댓글의 경로는 **모든 상위 댓글에서 해당 댓글까지의 경로를 포함**하도록 저장됩니다.
- **경로는 부모 경로를 상속하며, 독립적이면서 순차적인 형태를 유지합니다.**
- 📌 **이 방식은 댓글의 계층 구조를 명확하게 표현하고, 정렬 및 검색을 효율적으로 수행할 수 있도록 도와줍니다.**

## 🏗️9️⃣ Path Enumeration 방식의 계층형 댓글 구조 예시
<img src = "https://github.com/devKobe24/images2/blob/main/this_is_backend_img/infinite-depth-example_2.png?raw=true">

- 좌측 그림의 계층형 댓글 구조는, 우측 그림과 같은 경로 정보를 가질 수 있습니다.
- 각 경로는 **부모 댓글의 경로를 상속받으며,** 각 댓글마다 독립적이고 **순차적인 경로(문자열 정렬 기준)가** 생성됩니다.
- 📌 **이 방식은 댓글을 계층적으로 정렬하고, 빠르게 검색할 수 있도록 도와줍니다.**

## 🏗️1️⃣0️⃣ Path Enumeration 방식에서 경로 표현 범위 확장 방법
<img src = "https://github.com/devKobe24/images2/blob/main/this_is_backend_img/infinite-depth-example.png?raw=true">

- 각 경로는 depth(계층)마다 5자리의 문자로 표현되므로, 사용할 수 있는 경로의 개수에는 제한이 있습니다.
    - 만약 **각 자릿수를 숫자 (0~9)로만 사용한다면,** 한 depth당 **10⁵ = 100,000개(00000 ~ 99999)의 경로만 표현할 수 있습니다.**
- 하지만 문자열이기 때문에, 반드시 숫자(0~9)만 사용할 필요는 없습니다.
    - 각 자릿수는 **0~9(10개), A~Z(26개), a~z(26개) 총 62개의 문자를 사용할 수 있습니다.**
    - 문자열의 정렬 순서는 **숫자(0~9) ➞ 대문자 알파벳(A~Z) ➞ 소문자 알파벳(a~z) 순서**로 지정됩니다.
    - 따라서, 경로는 00000부터 zzzzz까지 순차적으로 생성됩니다.
    - **이 방식에서는 한 depth당 62⁵ = 16,132,832개의 경로를 표현할 수 있습니다.**
- 📌 **이러한 방식으로 경로 표현 범위를 확장하면, 더 많은 댓글을 저장할 수 있으며 트리 구조를 더욱 유연하게 유지할 수 있습니다.**

## 🚀 정리.

- ✅ **Path Enumeration(경로 열거) 방식은 댓글의 계층 구조를 문자열(path)로 저장하는 방식**
- ✅ **ORDER BY path ASC를 사용하여 트리 구조를 유지하면서 정렬 가능**
- ✅ **하위 댓글 조회 시 LIKE '경로%'를 활용하여 빠르게 검색 가능**
- ✅ **부모 댓글이 삭제되더라도 계층 구조를 유지하는 데 유리**
- ✅ **댓글 이동이 빈번한 경우 path 업데이트가 필요하므로 조심해야 함**
- ✅ **Path Enumeration 방식은 무한 Depth 댓글 정렬 및 조회 성능을 최적화할 수 있는 가장 효과적인 방법 중 하나입니다.**
- ✅ **트리 구조를 유지하면서 ORDER BY path ASC만으로 정렬이 가능하여 성능이 우수합니다.**
- ✅ **경로 길이가 길어지는 단점을 해결하기 위해 Base62와 같은 방식을 고려할 수도 있습니다.**
- 📌 **무한 Depth 댓글 정렬 및 조회 성능을 최적화할 수 있는 가장 효과적인 방법 중 하나입니다.**
